name: Flywheel Autonomous Maintenance

on:
  schedule:
    - cron: '0 6 * * *'
  workflow_dispatch:
    inputs:
      task:
        description: 'Custom task for Claude to execute'
        required: false
        type: string

permissions:
  contents: write
  issues: write
  pull-requests: write
  id-token: write

concurrency:
  group: claude-maintenance
  cancel-in-progress: true

jobs:
  autonomous-maintenance:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Run Claude Code - Maintenance
        uses: anthropics/claude-code-action@01e756b34ef7a1447e9508f674143b07d20c2631
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          claude_args: "--model claude-haiku-4-5-20251001 --max-turns 25"
          prompt: |
            You are the Flywheel autonomous maintenance agent. Perform these tasks:

            ${{ github.event.inputs.task || 'Run standard daily maintenance cycle.' }}

            Standard maintenance cycle:
            1. Review any open issues labeled 'agent-task' that haven't been addressed
            2. Check index.html for any broken links, invalid HTML, or console errors
            3. Review recent commits and update CHANGELOG.md if needed
            4. If there are actionable issues, pick the highest priority one and implement it
            5. Create a PR with any changes made

            Follow all guidelines in CLAUDE.md. If no maintenance is needed, do nothing.
